"use strict";function Serverinfo(t){const e=this;this.connection,this.verbinden=function(){e.connection=new WebSocket(t),e.connection.onopen=function(){document.body.style.cursor="wait",e.connection.send(JSON.stringify({purpose:"init"})),document.body.style.cursor="default"},e.connection.onmessage=function(t){let e=JSON.parse(t.data);if(e.purpose)switch(e.purpose){case"initialData":renderSysloadData(e.cpu),initCpuChart(e.cpuArchive),renderRamData(e.ram),initRamChart(e.ramArchive),renderHddData(e.hdd),renderContainerData(e.container),e.netLoad&&(renderNetworkData(e.netLoad.eth0),renderNetworkVpnData(e.netLoad.tun0)),renderSoftwareData(e.softVer),renderUptimeData(e.uptime);break;case"updateCpuData":renderSysloadData(e.data);break;case"updateRamData":renderRamData(e.data);break;case"updateHddData":renderHddData(e.data);break;case"updateContainerData":renderContainerData(e.data);break;case"updateNetLoadData":renderNetworkData(e.data.eth0),renderNetworkVpnData(e.data.tun0);break;case"updateSoftVerData":renderSoftwareData(e.data);break;case"updateUptimeData":renderUptimeData(e.data)}},e.connection.onerror=function(t){console.error(t)},e.connection.onclose=function(t){console.log(t)}}}function initCpuChart(t){cpuChart=new Chart(cpuChartCanvas,{type:"line",data:{datasets:[{data:t,backgroundColor:"#77997755",borderColor:"#008000",borderWidth:2,lineTension:0,pointRadius:0}]},options:chartOptions})}function updateCpuChart(t){if(cpuChart){for(cpuChart.data.datasets[0].data.push({y:t,t:new Date});cpuChart.data.datasets[0].data.length>360;)cpuChart.data.datasets[0].data.shift();cpuChart.update()}}function renderSysloadData(t){if(!t)return;cpuStatus.style.backgroundColor="green",cpuStatus.setAttribute("title",(new Date).toLocaleTimeString("de-de")),loadText.innerHTML="1 Min.: "+t.sysload[0].toFixed(2)+" - 5 Min.: "+t.sysload[1].toFixed(2)+" - 15 Min.: "+t.sysload[2].toFixed(2)+"<br>Nutzer: "+t.percentage.user+"% - Hintergrund: "+t.percentage.nice+"% - System: "+t.percentage.sys+"% - Leerlauf: "+t.percentage.idle+"%";const e=100-t.percentage.idle;updateCpuChart(e)}function initRamChart(t){ramChart=new Chart(ramChartCanvas,{type:"line",data:{datasets:[{data:t,backgroundColor:"#77997755",borderColor:"#008000",borderWidth:2,lineTension:0,pointRadius:0}]},options:chartOptions})}function updateRamChart(t){if(ramChart){for(ramChart.data.datasets[0].data.push({y:t,t:new Date});ramChart.data.datasets[0].data.length>180;)ramChart.data.datasets[0].data.shift();ramChart.update()}}function renderRamData(t){t&&(ramStatus.style.backgroundColor="green",ramStatus.setAttribute("title",(new Date).toLocaleTimeString("de-de")),ramText.innerHTML="Gesammt: "+t.total+" - Belegt: "+t.used+" - Frei: "+t.free,updateRamChart(t.percent))}function renderHddData(t){t&&(hddStatus.style.backgroundColor="green",hddStatus.setAttribute("title",(new Date).toLocaleTimeString("de-de")),hddText.innerHTML="Gesammt: "+t.total+" - Belegt: "+t.used+" - Frei: "+t.free,setCrircleChart(hddLadebalkenElem,t.percent))}function renderContainerData(t){if(t){containerStatus.style.backgroundColor="green",containerStatus.setAttribute("title",(new Date).toLocaleTimeString("de-de")),containers.clearChildren();for(let e in t.containers){const a=t.containers[e],n=document.createElement("div");n.className="container "+a.status.split(" ")[0],n.innerHTML=`<p class="container_name">${a.name}</p>\n                    <p class="container_image">${a.image}</p>\n                    <p class="container_status">${a.status}</p>\n                    <div class="container_loadBar_outer" title="CPU: ${a.cpu}">\n                        <div class="container_loadBar_inner cpu `+(a.cpu>100?"overload":a.cpu>67?"critical":a.cpu>50?"high":a.cpu>33?"increased":"")+`" style="width:${a.cpu>100?100:a.cpu}%" title="CPU: ${a.cpu}%"></div>\n                        <div class="container_loadBar_avg" style="left:${a.cpuAvg>100?100:a.cpuAvg}%"></div>\n                        <div class="container_loadBar_max" style="left:${a.cpuMax>100?100:a.cpuMax}%"></div>\n                    </div>\n                    <div class="container_loadBar_outer" title="RAM: ${a.ram}">\n                        <div class="container_loadBar_inner ram `+(a.ram>90?"critical":a.ram>80?"high":a.ram>67?"increased":"")+`" style="width:${a.ram>100?100:a.ram}%" title="RAM: ${a.ram}%"></div>\n                        <div class="container_loadBar_avg" style="left:${a.ramAvg>100?100:a.ramAvg}%"></div>\n                        <div class="container_loadBar_max" style="left:${a.ramMax>100?100:a.ramMax}%"></div>\n                    </div>`,containers.appendChild(n)}}}function renderNetworkData(t){t&&t.in&&t.out&&(ethStatus.style.backgroundColor="green",ethStatus.setAttribute("title",(new Date).toLocaleTimeString("de-de")),ethText.innerHTML="<table><tr><th></th><th>Gesammt</th><th>Gestern</th><th>Heute</th><th>Ltz. Stunde</th></tr><tr><td><b>Eingehend</b></td><td>"+t.in.total+"</td><td>"+t.in.yesterday+"</td><td>"+t.in.today+"</td><td>"+t.in.lasthour+"</td></tr><tr><td><b>Ausgehend</b></td><td>"+t.out.total+"</td><td>"+t.out.yesterday+"</td><td>"+t.out.today+"</td><td>"+t.out.lasthour+"</td></tr></table><br/>Durchschn. Auslastung: "+t.avgload+" ("+t.percent+"% bei 100 Mbit/s)")}function renderNetworkVpnData(t){t&&t.in&&t.out&&(vpnStatus.style.backgroundColor="green",vpnStatus.setAttribute("title",(new Date).toLocaleTimeString("de-de")),vpnText.innerHTML="<table><tr><th></th><th>Gesammt</th><th>Gestern</th><th>Heute</th><th>Ltz. Stunde</th></tr><tr><td><b>Eingehend</b></td><td>"+t.in.total+"</td><td>"+t.in.yesterday+"</td><td>"+t.in.today+"</td><td>"+t.in.lasthour+"</td></tr><tr><td><b>Ausgehend</b></td><td>"+t.out.total+"</td><td>"+t.out.yesterday+"</td><td>"+t.out.today+"</td><td>"+t.out.lasthour+"</td></tr></table>")}function renderSoftwareData(t){t&&(swStatus.style.backgroundColor="green",swStatus.setAttribute("title",(new Date).toLocaleTimeString("de-de")),softwareText.innerHTML="<b>OS:</b> "+t.os+" ● <b>Apache:</b> "+t.apache+" ● <b>PHP:</b> "+t.php+" ● <b>OpenSSL:</b> "+t.openssl)}function renderUptimeData(t){t&&(utStatus.style.backgroundColor="green",utStatus.setAttribute("title",(new Date).toLocaleTimeString("de-de")),uptimeText.innerHTML=t.uptime_formated)}function setCrircleChart(t,e){const a={percent:parseFloat(e)||1e-4,size:160,lineWidth:12,rotate:0},n=t.getElementsByTagName("canvas")[0]||document.createElement("canvas"),r=t.getElementsByTagName("span")[0]||document.createElement("span");r.textContent=a.percent.toFixed(2).replace(".",",")+"%","undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(n);const o=n.getContext("2d");n.width=n.height=a.size,t.appendChild(r),t.appendChild(n),o.translate(a.size/2,a.size/2),o.rotate((a.rotate/180-.5)*Math.PI);const d=(a.size-a.lineWidth)/2,i=function(t,e,a){a=Math.min(Math.max(0,a||1),1),o.beginPath(),o.arc(0,0,d,0,2*Math.PI*a,!1),o.strokeStyle=t,o.lineCap="round",o.lineWidth=e,o.stroke()};let s="green";e>90?s="purple":e>80?s="red":e>67&&(s="orange"),i("#efefef66",a.lineWidth,1),i(s,a.lineWidth+1,a.percent/100)}const hddText=document.querySelector("#hdd .text"),loadText=document.querySelector("#load.text"),ramText=document.querySelector("#ram.text"),ethText=document.querySelector("#eth .text"),vpnText=document.querySelector("#vpn .text"),containers=document.getElementById("containers"),softwareText=document.querySelector("#software .text"),uptimeText=document.querySelector("#uptime .text"),hddLadebalkenElem=document.querySelector("#hdd .ladebalken"),hddStatus=document.querySelector("#hdd_status"),cpuStatus=document.querySelector("#cpu_status"),ramStatus=document.querySelector("#ram_status"),ethStatus=document.querySelector("#eth_status"),vpnStatus=document.querySelector("#vpn_status"),containerStatus=document.querySelector("#container_status"),swStatus=document.querySelector("#sw_status"),utStatus=document.querySelector("#ut_status"),cpuChartCanvas=document.getElementById("cpuChart_chartcanvas"),ramChartCanvas=document.getElementById("ramChart_chartcanvas");setCrircleChart(hddLadebalkenElem,0);const chartOptions={maintainAspectRatio:!1,legend:{labels:!1},scales:{yAxes:[{ticks:{stepSize:25,fontColor:"#FFF",beginAtZero:!0,suggestedMin:0,suggestedMax:100},gridLines:{color:"#FFFFFF55"}}],xAxes:[{ticks:{stepSize:25,fontColor:"#FFF",source:"auto"},gridLines:{zeroLineColor:"#FFFFFF33",color:"#FFFFFF33"},type:"time",time:{unit:"minute",stepSize:1,displayFormats:{minute:"HH:mm"}}}]}};let cpuChart,ramChart;const serverinfo=new Serverinfo(("https:"===location.protocol?"wss://":"ws://")+location.host+"/ws");serverinfo.verbinden(),void 0===Element.prototype.clearChildren&&Object.defineProperty(Element.prototype,"clearChildren",{configurable:!0,enumerable:!1,value:function(){for(;this.firstChild;)this.removeChild(this.lastChild)}});